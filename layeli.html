<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>شربة ضد بريك - THE FIGHT</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@700;900&display=swap" rel="stylesheet">
    <style>
        /* Floating Background Container */
.bg-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1; /* Keeps it behind everything */
    overflow: hidden;
    pointer-events: none; /* Allows you to click buttons through the images */
}

/* Individual Image Styling */
.floating-img {
    position: absolute;
    opacity: 1; /* Adjust transparency (0.1 to 1.0) */
    animation: floatUp linear infinite;
    filter: drop-shadow(0 0 5px rgba(0,0,0,0.5));
}

/* The Movement Animation */
@keyframes floatUp {
    0% { 
        transform: translateY(110vh) rotate(0deg); 
    }
    100% { 
        transform: translateY(-20vh) rotate(360deg); 
    }
}
        :root { 
            --orange: #ff4d00; 
            --dark-red: #8b0000;
            --dark: #0a0a0a; 
            --metal: #2d3436;
            --gold: #ffd700;
            --green: #2ecc71;
            --red: #df0024;
        }

        body { 
            font-family: 'Tajawal', sans-serif; 
            background: radial-gradient(circle, #1a1a1a 0%, #000000 100%);
            color: white;
            margin: 0; 
            padding: 20px; 
            display: flex; 
            flex-direction: column; 
            align-items: center;
            overflow-x: hidden;
        }

        h1 { 
            font-size: 3.5rem;
            text-shadow: 0 0 20px var(--orange);
            margin-bottom: 10px;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .screen { width: 100%; max-width: 1100px; text-align: center; }
        .hidden { display: none; }

        .grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); 
            gap: 20px; 
            margin-top: 30px; 
        }

        .card { 
            background: linear-gradient(145deg, #1f1f1f, #000);
            border: 2px solid #444;
            border-radius: 5px; 
            padding: 20px; 
            cursor: pointer; 
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .card:hover { 
            border-color: var(--orange); 
            transform: scale(1.05);
            box-shadow: 0 0 20px var(--orange);
        }

        .card.selected { 
            border-color: var(--gold);
            background: #fff;
            color: #000;
            box-shadow: 0 6px 24px rgba(0,0,0,0.25);
        }
        .card.selected .name, .card.selected .img-index { color: #000; }

        .turn-indicator {
            font-size: 2rem;
            margin: 20px;
            padding: 15px;
            border: 3px solid var(--gold);
            display: inline-block;
            background: #000;
        }

        .team-chorba { color: var(--orange); text-shadow: 0 0 10px var(--orange); }
        .team-brik { color: var(--green); text-shadow: 0 0 10px var(--green); }

        .board { background: rgba(0,0,0,0.8); padding: 30px; border: 2px solid #333; }
        .row { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; }
        .label { font-size: 1.4rem; font-weight: 900; width: 250px; text-align: right; color: var(--gold); }
        
        .dots { display: flex; gap: 10px; }
        .dot { 
            width: 50px; height: 50px; 
            background: #222; border: 2px solid #555;
            cursor: pointer; display: flex; align-items: center; justify-content: center; 
            font-size: 1.2rem; transition: 0.2s;
        }
        .dot:hover { background: var(--orange); border-color: white; }
        .dot.used-wrong { background: var(--red); border-color: white; pointer-events: none; }

        #modal-overlay { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.95); display: none; justify-content: center; align-items: center; z-index: 1000; 
        }
        .modal { 
            background: #111; border: 4px solid var(--orange); padding: 50px; 
            width: 80%; max-width: 800px; text-align: center; box-shadow: 0 0 50px var(--orange);
        }
        .question-text { font-size: 2rem; margin: 30px 0; color: #fff; }
        .answer-text { font-size: 1.8rem; color: var(--gold); margin-top: 20px; display: none; border-top: 2px solid #333; padding-top: 20px; }

        .score-box { font-size: 1.5rem; margin-bottom: 10px; }

        #timer-display {
            font-size: 3rem;
            font-weight: 900;
            color: var(--gold);
            text-shadow: 0 0 20px var(--gold);
            margin: 20px 0;
            padding: 15px;
            border: 3px solid var(--gold);
            background: rgba(0,0,0,0.8);
            display: inline-block;
        }
        #timer-display.warning { color: var(--red); text-shadow: 0 0 20px var(--red); border-color: var(--red); }
        #timer-display.danger { animation: pulse 0.5s infinite; }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .dot.used-correct { background: var(--green); border-color: white; pointer-events: none; }

        .game-controls {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        button.control-btn {
            padding: 12px 30px;
            font-size: 1rem;
            background: var(--metal);
            border: 2px solid var(--orange);
        }
        button.control-btn:hover {
            background: var(--orange);
            transform: scale(1.05);
        }

        button { 
            padding: 15px 50px; background: var(--orange); color: white; border: none; 
            font-weight: 900; font-size: 1.2rem; cursor: pointer; margin: 5px;
        }
        button.correct { background: var(--green); }
        button.wrong { background: var(--red); }

        .prayer-times {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid var(--gold);
            padding: 15px;
            border-radius: 10px;
            font-size: 0.9rem;
            z-index: 100;
            min-width: 200px;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
        }
        .prayer-times h4 {
            margin: 0 0 10px 0;
            color: var(--gold);
            text-align: center;
            font-size: 1rem;
        }
        .prayer-time-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .prayer-time-item:last-child {
            border-bottom: none;
        }
        .prayer-name {
            color: #ccc;
        }
        .prayer-time {
            color: var(--gold);
            font-weight: 700;
        }

        .card:focus {
            outline: 3px solid var(--orange);
            outline-offset: 2px;
        }
        .card.focused {
            border-color: var(--orange);
            transform: scale(1.05);
            box-shadow: 0 0 20px var(--orange);
        }

        .category-section {
            margin-bottom: 40px;
        }
        .category-section-title {
            font-size: 1.8rem;
            color: var(--gold);
            margin-bottom: 20px;
            text-align: right;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--orange);
        }
    </style>
</head>
<body>
    <div class="bg-container" id="bg-container"></div>

   

    <div id="selection-screen" class="screen">
        <h1>TEAM CHORBA VS TEAM BRIK</h1>
        <p>اختر 5 فئات (سيتم اختيار 4 أسئلة عشوائية من كل فئة)</p>
        <p>المختار: <span id="count" style="color:var(--gold)">0</span> / 5</p>
        <div class="grid" id="categoryGrid"></div>
        <div style="margin-top:40px">
            <button id="nextBtn" disabled onclick="showBoard()">إبدا </button>
        </div>
    </div>

    <div id="game-screen" class="screen hidden">
        <div class="score-box">
            <span class="team-chorba">شربة: <span id="score-chorba">0</span></span> | 
            <span class="team-brik">بريك: <span id="score-brik">0</span></span>
        </div>
        <div id="turn-display" class="turn-indicator team-chorba">دور فريق: شربة</div>
        <div class="game-controls">
            <button class="control-btn" onclick="restartGame()">إعادة اللعبة</button>
            <button class="control-btn" onclick="startNewGame()">لعبة جديدة</button>
        </div>
        <div class="board" id="gameBoard"></div>
    </div>

    <div id="modal-overlay">
        <div class="modal">
            <h2 id="modal-category" style="color:var(--orange)">الفئة</h2>
            <div id="timer-display">30</div>
            <div class="question-text" id="modal-question"></div>
            
            <button id="show-answer-btn" onclick="showAnswer()" tabindex="0">كشف الإجابة</button>
            
            <div id="modal-answer-area" style="display:none">
                <div class="answer-text" id="modal-answer"></div>
                <p>هل الإجابة صحيحة؟</p>
                <button id="correct-btn" class="correct" onclick="submitResult(true)" tabindex="0">صح ✔ (1)</button>
                <button id="wrong-btn" class="wrong" onclick="submitResult(false)" tabindex="0">خطأ ✖ (2)</button>
            </div>
        </div>
    </div>
<script src="questions.json"></script>
    <script>
        const bgContainer = document.getElementById('bg-container');

// Function to create floating elements
function createFloatingBackground() {
    // 10 of img1 and 10 of img2
    const images = ['img1.png', 'img2.png'];
    
    images.forEach(src => {
        for (let i = 0; i < 10; i++) {
            const img = document.createElement('img');
            img.src = src;
            img.className = 'floating-img';
            
            // Randomize appearance and timing
            const randomLeft = Math.random() * 100; // Position 0-100%
            const randomSize = 40 + Math.random() * 60; // Size between 40px and 100px
            const randomDuration = 10 + Math.random() * 20; // Speed between 10s and 30s
            const randomDelay = Math.random() * 20; // Start at different times
            
            img.style.left = `${randomLeft}%`;
            img.style.width = `${randomSize}px`;
            img.style.animationDuration = `${randomDuration}s`;
            img.style.animationDelay = `-${randomDelay}s`; // Negative delay so they are already on screen
            
            bgContainer.appendChild(img);
        }
    });
}

// Run the function immediately
createFloatingBackground();
// Selection sound (plays when a topic is picked)
const selectAudio = new Audio('h.mp3');
function playSelectSound(){
    try { selectAudio.currentTime = 0; selectAudio.play(); } catch(e) {}
}

let selectedCategories = [];
let activeQuestion = null;
let activeDot = null;
let currentTeam = "chorba"; // chorba or brik
let scores = { chorba: 0, brik: 0 };
let gameData = {};
let timerInterval = null;
let timerSeconds = 30;
let timerEnabled = true;
let categoryCards = [];
let focusedCardIndex = -1;

// Organize categories by type
const categoryGroups = {
    "الرياضة": [
        "كرة القدم التونسية", "كلاسيكو", "الدوري الإنجليزي", "خمن اللاعب",
        "دوري أبطال أوروبا", "فورمولا 1", "NBA", "Tennis", " UFC", 
        "نسور قرطاج", "موسوعة كأس العالم FIFA", "كأس الأمم الإفريقية"
    ],
    "الترفيه والمسلسلات": [
        "مسلسل الحفرة", "شوفلي حل", "الدراما التركية", "الدراما المصرية",
        "السينما العالمية", "Breaking Bad", "Game Of Thrones", "مسلسل Stranger Things",
        "مسلسل The Office US"
    ],
    "الأنمي والألعاب": [
        "أنمي", "Attack on Titan", "OnePiece", "GTA", "Call Of Duty",
        "Valorant", "موسوعة ألعاب الفيديو Gaming", "موسوعة المصارعة الحرة WWE"
    ],
    "الدين": [
        "القرآن جزء عم", "علوم القرآن الكريم", "قصص الأنبياء, يوسف عليه السلام", "عيد الفطر"
    ],
    "الجغرافيا والتاريخ": [
        "عواصم الدول", "الجغرافيا", "تاريخ تونس", "تاريخ الحرب العالمية الثانية"
    ],
    "أخرى": [
        "هاري بوتر", "مارفل MCU", "الهيب هوب", "موسوعة عملات العالم Currencies"
    ],
    
};

// Load prayer times for Tunisia
async function loadPrayerTimes() {
    try {
        const today = new Date();
        const year = today.getFullYear();
        const month = today.getMonth() + 1;
        const day = today.getDate();
        
        // Using Aladhan API for Tunisia (Tunis coordinates: 36.8065, 10.1815)
        const response = await fetch(`https://api.aladhan.com/v1/calendar/${year}/${month}?latitude=36.8065&longitude=10.1815&method=3&school=1`);
        const data = await response.json();
        
        if (data.code === 200 && data.data) {
            const todayData = data.data.find(d => d.date.gregorian.day == day);
            if (todayData && todayData.timings) {
                const timings = todayData.timings;
                const prayerNames = {
                    'Fajr': 'الفجر',
                    'Dhuhr': 'الظهر',
                    'Asr': 'العصر',
                    'Maghrib': 'المغرب',
                    'Isha': 'العشاء'
                };
                
                let html = '';
                Object.keys(prayerNames).forEach(key => {
                    if (timings[key]) {
                        const time = timings[key].split(' ')[0];
                        const [hours, minutes] = time.split(':');
                        html += `<div class="prayer-time-item">
                            <span class="prayer-name">${prayerNames[key]}</span>
                            <span class="prayer-time">${hours}:${minutes}</span>
                        </div>`;
                    }
                });
                
                document.getElementById('prayer-times-content').innerHTML = html;
            }
        }
    } catch (error) {
        console.error('Error loading prayer times:', error);
        document.getElementById('prayer-times-content').innerHTML = '<div style="color: #999; text-align: center;">غير متاح</div>';
    }
}

// Load prayer times on page load
loadPrayerTimes();

// 1. Selection Screen Logic — flattened categories
// inject small CSS for cover thumbnails and index labels (non-destructive)
(function(){
    const s = document.createElement('style');
    s.textContent = `
        #categoryGrid .card { display:flex; flex-direction:column; align-items:center; justify-content:center; gap:10px; padding:12px; min-height:220px; }
        /* Instagram-style portrait covers (4:5) */
        #categoryGrid .card .cover { width:140px; height:175px; flex:0 0 auto; border-radius:10px; overflow:hidden; background:#111; box-shadow:0 6px 18px rgba(0,0,0,0.45); }
        #categoryGrid .card .cover img{ width:100%; height:100%; object-fit:cover; display:block; }
        #categoryGrid .card .title{ display:flex; flex-direction:column; align-items:center; gap:6px; margin-top:8px; text-align:center; }
        #categoryGrid .card .name{ font-size:1rem; line-height:1.2rem; font-weight:700; }
        #categoryGrid .card .img-index{ font-size:0.75rem; opacity:0.95; color:var(--gold); }
        @media (max-width:780px){ #categoryGrid .card .cover { width:120px; height:150px; } }
        @media (max-width:420px){ #categoryGrid .card .cover { width:96px; height:120px; } }
    `;
    document.head.appendChild(s);
})();

const grid = document.getElementById('categoryGrid');
Object.keys(quizData).forEach((cat, ci) => {
    const imgIndex = ci + 1;
    const card = document.createElement('div');
    card.className = 'card';
    card.setAttribute('tabindex', '0');
    card.dataset.category = cat;
    card.dataset.imgIndex = String(imgIndex);
    card.innerHTML = `<div class="cover"><img src="${imgIndex}.png" alt="cover" onerror="this.style.display='none'"></div><div class="title"><span class="name">${cat}</span><span class="img-index">${imgIndex}</span></div>`;

    const selectCard = () => {
        if (card.classList.contains('selected')) {
            card.classList.remove('selected');
            selectedCategories = selectedCategories.filter(c => c !== cat);
        } else if (selectedCategories.length < 5) {
            card.classList.add('selected');
            selectedCategories.push(cat);
        }
        document.getElementById('count').innerText = selectedCategories.length;
        document.getElementById('nextBtn').disabled = selectedCategories.length !== 5;
    };

    card.onclick = selectCard;

    // Keyboard support
    card.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            selectCard();
        } else if (e.key === 'ArrowRight' || e.key === 'ArrowLeft') {
            e.preventDefault();
            navigateCards(e.key === 'ArrowRight' ? 1 : -1);
        } else if (e.key === 'ArrowUp' || e.key === 'ArrowDown') {
            e.preventDefault();
            navigateCards(e.key === 'ArrowDown' ? 1 : -1);
        }
    });

    card.addEventListener('focus', () => {
        card.classList.add('focused');
        focusedCardIndex = categoryCards.indexOf(card);
    });

    card.addEventListener('blur', () => {
        card.classList.remove('focused');
    });

    categoryCards.push(card);
    grid.appendChild(card);
});

function navigateCards(direction) {
    if (categoryCards.length === 0) return;
    
    focusedCardIndex += direction;
    if (focusedCardIndex < 0) focusedCardIndex = categoryCards.length - 1;
    if (focusedCardIndex >= categoryCards.length) focusedCardIndex = 0;
    
    categoryCards[focusedCardIndex].focus();
}

function randomSelect() {
    // Deselect all currently selected
    categoryCards.forEach(card => card.classList.remove('selected'));
    selectedCategories = [];
    document.getElementById('count').innerText = '0';

    const allCats = Object.keys(quizData);
    let tempSelected = [];
    const interval = setInterval(() => {
        categoryCards.forEach(card => card.classList.remove('temp-selected'));
        tempSelected = [];
        while (tempSelected.length < 5) {
            const randomCat = allCats[Math.floor(Math.random() * allCats.length)];
            if (!tempSelected.includes(randomCat)) tempSelected.push(randomCat);
        }
        tempSelected.forEach(cat => {
            const card = categoryCards.find(c => c.dataset.category === cat);
            if (card) card.classList.add('temp-selected');
        });
    }, 100);
    setTimeout(() => {
        clearInterval(interval);
        categoryCards.forEach(card => card.classList.remove('temp-selected'));
        selectedCategories = tempSelected;
        selectedCategories.forEach(cat => {
            const card = categoryCards.find(c => c.dataset.category === cat);
            if (card) card.classList.add('selected');
        });
        document.getElementById('count').innerText = selectedCategories.length;
        document.getElementById('nextBtn').disabled = false;
    }, 2000);
}

function toggleTimer() {
    timerEnabled = !timerEnabled;
    document.getElementById('timerToggle').innerText = timerEnabled ? 'تعطيل المؤقت' : 'تفعيل المؤقت';
}

// 2. Game Logic
function showBoard() {
    document.getElementById('selection-screen').classList.add('hidden');
    document.getElementById('game-screen').classList.remove('hidden');
    
    const board = document.getElementById('gameBoard');
    selectedCategories.forEach(cat => {
        // Keep only 4 random questions from the category
        const shuffled = [...quizData[cat]].sort(() => 0.5 - Math.random());
        gameData[cat] = shuffled.slice(0, 4);

        const row = document.createElement('div');
        row.className = 'row';
        row.innerHTML = `<div class="label">${cat}</div>`;
        
        const dotsCont = document.createElement('div');
        dotsCont.className = 'dots';
        
        gameData[cat].forEach((qObj, idx) => {
            const dot = document.createElement('div');
            dot.className = 'dot';
            dot.innerText = idx + 1;
            dot.onclick = () => openQuestion(cat, idx, dot);
            dotsCont.appendChild(dot);
        });
        
        row.appendChild(dotsCont);
        board.appendChild(row);
    });
}

function openQuestion(cat, idx, dotEl) {
    activeQuestion = gameData[cat][idx];
    activeDot = dotEl;
    
    document.getElementById('modal-category').innerText = cat;
    document.getElementById('modal-question').innerText = activeQuestion.q;
    document.getElementById('modal-answer').innerText = activeQuestion.a;
    
    document.getElementById('modal-answer-area').style.display = 'none';
    document.getElementById('show-answer-btn').style.display = 'inline-block';
    document.getElementById('modal-overlay').style.display = 'flex';

    const timerDisplay = document.getElementById('timer-display');
    if (timerEnabled) {
        timerDisplay.style.display = 'block';
        startTimer();
    } else {
        timerDisplay.style.display = 'none';
    }
}

function showAnswer() {
    document.getElementById('show-answer-btn').style.display = 'none';
    document.getElementById('modal-answer-area').style.display = 'block';
    document.getElementById('modal-answer').style.display = 'block';
    
    // Focus on correct button for keyboard navigation
    setTimeout(() => {
        const correctBtn = document.getElementById('correct-btn');
        if (correctBtn) correctBtn.focus();
    }, 100);
}

// Add keyboard support for modal buttons
(function() {
    // Wait for DOM to be ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initKeyboardSupport);
    } else {
        initKeyboardSupport();
    }
    
    function initKeyboardSupport() {
        // Keyboard support for show answer button
        const showAnswerBtn = document.getElementById('show-answer-btn');
        if (showAnswerBtn) {
            showAnswerBtn.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    showAnswer();
                }
            });
        }
        
        // Global keyboard shortcuts for answer buttons
        document.addEventListener('keydown', (e) => {
            const modal = document.getElementById('modal-overlay');
            if (modal && modal.style.display === 'flex') {
                const answerArea = document.getElementById('modal-answer-area');
                if (answerArea && answerArea.style.display !== 'none') {
                    if (e.key === '1') {
                        e.preventDefault();
                        submitResult(true);
                    } else if (e.key === '2') {
                        e.preventDefault();
                        submitResult(false);
                    }
                } else if (e.key === 'Enter' || e.key === ' ') {
                    const showBtn = document.getElementById('show-answer-btn');
                    if (showBtn && showBtn.style.display !== 'none') {
                        e.preventDefault();
                        showAnswer();
                    }
                }
            }
        });
        
        // Keyboard navigation between answer buttons
        const correctBtn = document.getElementById('correct-btn');
        const wrongBtn = document.getElementById('wrong-btn');
        
        if (correctBtn) {
            correctBtn.addEventListener('keydown', (e) => {
                if (e.key === 'ArrowRight' || e.key === 'ArrowLeft') {
                    e.preventDefault();
                    if (wrongBtn) wrongBtn.focus();
                }
            });
        }
        
        if (wrongBtn) {
            wrongBtn.addEventListener('keydown', (e) => {
                if (e.key === 'ArrowRight' || e.key === 'ArrowLeft') {
                    e.preventDefault();
                    if (correctBtn) correctBtn.focus();
                }
            });
        }
    }
})();

function startTimer() {
    // Clear any existing timer
    if (timerInterval) {
        clearInterval(timerInterval);
    }
    
    timerSeconds = 30;
    const timerDisplay = document.getElementById('timer-display');
    timerDisplay.innerText = timerSeconds;
    timerDisplay.className = '';
    
    timerInterval = setInterval(() => {
        timerSeconds--;
        timerDisplay.innerText = timerSeconds;
        
        // Add warning style when time is running out
        if (timerSeconds <= 10) {
            timerDisplay.classList.add('warning');
            if (timerSeconds <= 5) {
                timerDisplay.classList.add('danger');
            }
        }
        
        if (timerSeconds <= 0) {
            clearInterval(timerInterval);
            timerInterval = null;
            // Automatically show answer when time runs out
            if (document.getElementById('show-answer-btn').style.display !== 'none') {
                showAnswer();
            }
        }
    }, 1000);
}

function stopTimer() {
    if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
    }
    const timerDisplay = document.getElementById('timer-display');
    timerDisplay.className = '';
    timerDisplay.innerText = '30';
}

function submitResult(isCorrect) {
    // Stop timer
    stopTimer();
    
    if (isCorrect) {
        scores[currentTeam]++;
        activeDot.classList.add('used-correct');
        document.getElementById(`score-${currentTeam}`).innerText = scores[currentTeam];
    } else {
        activeDot.classList.add('used-wrong');
    }

    // إغلاق المودال
    document.getElementById('modal-overlay').style.display = 'none';

    // التحقق مما إذا كانت كل النقاط (الأسئلة) قد استُخدمت
    const allDots = document.querySelectorAll('.dot');
    const usedDots = document.querySelectorAll('.dot.used-correct, .dot.used-wrong');
    
    if (allDots.length === usedDots.length) {
        // إظهار رسالة النهاية المطلوبة
        alert("توا احسبوا مجموع الأوراق اللي في إيديكم، والفريق اللي مجموعُه أكبر هو الرابح.");
        return; // توقف هنا لأن اللعبة انتهت
    }

    // تبديل الأدوار في حال لم تنتهِ اللعبة
    currentTeam = currentTeam === "chorba" ? "brik" : "chorba";
    const turnDisplay = document.getElementById('turn-display');
    turnDisplay.innerText = `دور فريق: ${currentTeam === 'chorba' ? 'شربة' : 'بريك'}`;
    turnDisplay.className = `turn-indicator team-${currentTeam}`;
}

function restartGame() {
    // Stop timer if running
    stopTimer();
    
    // Close modal if open
    document.getElementById('modal-overlay').style.display = 'none';
    
    // Reset scores
    scores = { chorba: 0, brik: 0 };
    document.getElementById('score-chorba').innerText = '0';
    document.getElementById('score-brik').innerText = '0';
    
    // Reset current team
    currentTeam = "chorba";
    const turnDisplay = document.getElementById('turn-display');
    turnDisplay.innerText = 'دور فريق: شربة';
    turnDisplay.className = 'turn-indicator team-chorba';
    
    // Reset all dots
    const allDots = document.querySelectorAll('.dot');
    allDots.forEach(dot => {
        dot.classList.remove('used-correct', 'used-wrong');
    });
    
    // Regenerate game board with same categories
    const board = document.getElementById('gameBoard');
    board.innerHTML = '';
    
    Object.keys(gameData).forEach(cat => {
        // Keep only 4 random questions from the category
        const shuffled = [...quizData[cat]].sort(() => 0.5 - Math.random());
        gameData[cat] = shuffled.slice(0, 4);

        const row = document.createElement('div');
        row.className = 'row';
        row.innerHTML = `<div class="label">${cat}</div>`;
        
        const dotsCont = document.createElement('div');
        dotsCont.className = 'dots';
        
        gameData[cat].forEach((qObj, idx) => {
            const dot = document.createElement('div');
            dot.className = 'dot';
            dot.innerText = idx + 1;
            dot.onclick = () => openQuestion(cat, idx, dot);
            dotsCont.appendChild(dot);
        });
        
        row.appendChild(dotsCont);
        board.appendChild(row);
    });
}

function startNewGame() {
    // Stop timer if running
    stopTimer();
    
    // Close modal if open
    document.getElementById('modal-overlay').style.display = 'none';
    
    // Reset everything
    selectedCategories = [];
    scores = { chorba: 0, brik: 0 };
    gameData = {};
    currentTeam = "chorba";
    
    // Reset selection screen
    document.getElementById('count').innerText = '0';
    document.getElementById('nextBtn').disabled = true;
    
    // Reset all cards
    const cards = document.querySelectorAll('.card');
    cards.forEach(card => {
        card.classList.remove('selected');
    });
    
    // Go back to selection screen
    document.getElementById('game-screen').classList.add('hidden');
    document.getElementById('selection-screen').classList.remove('hidden');
    
    // Clear game board
    document.getElementById('gameBoard').innerHTML = '';
    
    // Reset score display
    document.getElementById('score-chorba').innerText = '0';
    document.getElementById('score-brik').innerText = '0';
    
    // Reset turn display
    const turnDisplay = document.getElementById('turn-display');
    turnDisplay.innerText = 'دور فريق: شربة';
    turnDisplay.className = 'turn-indicator team-chorba';
    
}
</script>
</body>
</html>
